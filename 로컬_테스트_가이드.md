# 로컬 테스트 가이드

Docker 없이 로컬에서 알림 시스템을 테스트하는 방법입니다.

## 사전 요구사항

1. **Java 17 이상** 설치
2. **Gradle** (프로젝트에 포함됨)

## 빠른 시작

### 1. 서버 실행
```bash
# 배치 파일 사용 (Windows)
test_local.bat

# 또는 직접 실행
gradlew.bat bootRun --args='--spring.profiles.active=test'
```

### 2. API 테스트
```bash
# PowerShell 스크립트 사용
.\test_api_local.ps1

# 또는 브라우저에서 직접 테스트
http://localhost:8080/api/test/health
http://localhost:8080/api/test/hello
http://localhost:8080/api/test/info
```

## 테스트 API 엔드포인트

### 기본 테스트
- `GET /api/test/health` - 서버 상태 확인
- `GET /api/test/hello` - 간단한 인사말
- `GET /api/test/info` - 서버 정보 조회
- `POST /api/test/echo` - 요청 데이터 반환

### 알림 API (기본 기능)
- `POST /api/notifications/send/user/{userId}` - 특정 사용자에게 알림 전송
- `POST /api/notifications/send/all` - 모든 사용자에게 알림 전송
- `GET /api/notifications/user/{userId}` - 사용자별 알림 조회
- `GET /api/notifications/status/{status}` - 상태별 알림 조회

## 데이터베이스 확인

H2 콘솔에 접속하여 데이터베이스 상태를 확인할 수 있습니다:

1. 브라우저에서 `http://localhost:8080/h2-console` 접속
2. 설정 정보:
   - JDBC URL: `jdbc:h2:mem:testdb`
   - 사용자명: `sa`
   - 비밀번호: (비어있음)

## 테스트 예시

### 1. 서버 상태 확인
```bash
curl http://localhost:8080/api/test/health
```

### 2. 알림 전송 테스트
```bash
# 특정 사용자에게 알림 전송
curl -X POST "http://localhost:8080/api/notifications/send/user/user123?title=테스트&message=안녕하세요&type=INFO"

# 모든 사용자에게 알림 전송
curl -X POST "http://localhost:8080/api/notifications/send/all?title=공지사항&message=시스템 점검 예정&type=WARNING"
```

### 3. 알림 조회 테스트
```bash
# 사용자별 알림 조회
curl http://localhost:8080/api/notifications/user/user123

# 상태별 알림 조회
curl http://localhost:8080/api/notifications/status/PENDING
```

## 문제 해결

### 1. 포트 충돌
- 8080 포트가 사용 중인 경우 `application-test.properties`에서 `server.port` 변경

### 2. Java 버전 문제
- Java 17 이상이 설치되어 있는지 확인: `java -version`

### 3. 빌드 오류
- Gradle 캐시 정리: `gradlew.bat clean`
- 의존성 다시 다운로드: `gradlew.bat --refresh-dependencies`

### 4. 서버 시작 실패
- 로그 확인: `gradlew.bat bootRun --args='--spring.profiles.active=test' --debug`

## 로그 확인

애플리케이션 실행 중 로그를 통해 다음을 확인할 수 있습니다:
- 서버 시작 상태
- 데이터베이스 연결 상태
- API 요청/응답 로그
- 오류 메시지

## 테스트 완료 후

서버를 종료하려면:
- 터미널에서 `Ctrl+C` 누르기
- 또는 터미널 창 닫기

---

**참고**: 이 테스트 환경은 H2 메모리 데이터베이스를 사용하므로 서버 재시작 시 모든 데이터가 초기화됩니다. 
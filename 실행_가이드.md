# 🚀 사용자 알림 시스템 실행 가이드

## 📋 사전 요구사항

### 1. 필수 소프트웨어 설치
- **Java 17 이상** (OpenJDK 또는 Oracle JDK)
- **MongoDB 6.0 이상**
- **Apache Kafka 3.0 이상**
- **Git**

### 2. Java 설치 확인
```bash
java -version
```
Java 17 이상이 설치되어 있어야 합니다.

## 🔧 1단계: MongoDB 설정

### MongoDB 설치 및 실행
1. **MongoDB Community Server 다운로드**: https://www.mongodb.com/try/download/community
2. **MongoDB 실행**:
   ```bash
   # Windows의 경우 (MongoDB가 서비스로 설치된 경우)
   net start MongoDB
   
   # 또는 MongoDB Compass GUI 도구 사용
   ```

### MongoDB 데이터베이스 생성
1. **MongoDB Compass** 또는 **MongoDB Shell** 실행
2. **새 데이터베이스 생성**:
   - 데이터베이스 이름: `notification_system`
   - 컬렉션 이름: `users` (자동 생성됨)

## 🔧 2단계: Apache Kafka 설정

### Kafka 다운로드 및 실행
1. **Apache Kafka 다운로드**: https://kafka.apache.org/downloads
2. **압축 해제 후 실행**:
   ```bash
   # Kafka 디렉토리로 이동
   cd kafka_2.13-3.6.1
   
   # Zookeeper 시작 (새 터미널에서)
   bin/zookeeper-server-start.sh config/zookeeper.properties
   
   # Kafka 서버 시작 (새 터미널에서)
   bin/kafka-server-start.sh config/server.properties
   ```

### Kafka 토픽 생성
```bash
# 사용자 생성 토픽
bin/kafka-topics.sh --create --topic user-created --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1

# 알림 토픽
bin/kafka-topics.sh --create --topic notifications --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1
```

## 🔧 3단계: 프로젝트 실행

### 1. 프로젝트 클론 (이미 있는 경우 생략)
```bash
git clone https://github.com/nojong99/notification.git
cd notification
```

### 2. 애플리케이션 실행
```bash
# Gradle을 사용하여 실행
./gradlew bootRun

# 또는 Windows의 경우
gradlew.bat bootRun
```

### 3. 실행 확인
애플리케이션이 성공적으로 실행되면 다음 메시지가 표시됩니다:
```
Started PlayApplication in X.XXX seconds
```

## 🧪 4단계: API 테스트

### 1. 사용자 생성 테스트
```bash
# POST 요청으로 사용자 생성
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "phoneNumber": "010-1234-5678"
  }'
```

**예상 응답**:
```json
{
  "id": "507f1f77bcf86cd799439011",
  "username": "testuser",
  "email": "test@example.com",
  "phoneNumber": "010-1234-5678",
  "createdAt": "2024-01-15T10:30:00.000Z"
}
```

### 2. 사용자 목록 조회 테스트
```bash
# GET 요청으로 모든 사용자 조회
curl http://localhost:8080/api/users
```

### 3. 특정 사용자 조회 테스트
```bash
# 특정 사용자 ID로 조회 (위에서 생성된 ID 사용)
curl http://localhost:8080/api/users/507f1f77bcf86cd799439011
```

### 4. 알림 생성 테스트
```bash
# POST 요청으로 알림 생성
curl -X POST http://localhost:8080/api/notifications \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "507f1f77bcf86cd799439011",
    "title": "환영합니다!",
    "message": "알림 시스템에 가입해주셔서 감사합니다.",
    "type": "WELCOME"
  }'
```

**예상 응답**:
```json
{
  "id": "507f1f77bcf86cd799439012",
  "userId": "507f1f77bcf86cd799439011",
  "title": "환영합니다!",
  "message": "알림 시스템에 가입해주셔서 감사합니다.",
  "type": "WELCOME",
  "status": "PENDING",
  "createdAt": "2024-01-15T10:35:00.000Z"
}
```

### 5. 사용자별 알림 조회 테스트
```bash
# 특정 사용자의 모든 알림 조회
curl http://localhost:8080/api/users/507f1f77bcf86cd799439011/notifications
```

## 🔍 5단계: 모니터링 및 확인

### 1. Kafka 메시지 확인
```bash
# 사용자 생성 토픽 메시지 확인
bin/kafka-console-consumer.sh --topic user-created --bootstrap-server localhost:9092 --from-beginning

# 알림 토픽 메시지 확인
bin/kafka-console-consumer.sh --topic notifications --bootstrap-server localhost:9092 --from-beginning
```

### 2. MongoDB 데이터 확인
**MongoDB Compass**에서:
- `notification_system` 데이터베이스
- `users` 컬렉션: 생성된 사용자들
- `notifications` 컬렉션: 생성된 알림들

### 3. 애플리케이션 로그 확인
애플리케이션 콘솔에서 다음 로그들을 확인할 수 있습니다:
```
- 사용자 생성 로그
- Kafka 메시지 발행 로그
- 알림 생성 로그
- Kafka 메시지 소비 로그
```

## 🛠️ 6단계: 고급 테스트 시나리오

### 시나리오 1: 다중 사용자 생성 및 알림
```bash
# 여러 사용자 생성
curl -X POST http://localhost:8080/api/users -H "Content-Type: application/json" -d '{"username": "user1", "email": "user1@example.com", "phoneNumber": "010-1111-1111"}'
curl -X POST http://localhost:8080/api/users -H "Content-Type: application/json" -d '{"username": "user2", "email": "user2@example.com", "phoneNumber": "010-2222-2222"}'
curl -X POST http://localhost:8080/api/users -H "Content-Type: application/json" -d '{"username": "user3", "email": "user3@example.com", "phoneNumber": "010-3333-3333"}'

# 각 사용자에게 알림 전송
curl -X POST http://localhost:8080/api/notifications -H "Content-Type: application/json" -d '{"userId": "USER_ID_1", "title": "시스템 업데이트", "message": "새로운 기능이 추가되었습니다.", "type": "SYSTEM"}'
```

### 시나리오 2: 알림 상태 변경
```bash
# 알림 상태를 READ로 변경
curl -X PUT http://localhost:8080/api/notifications/NOTIFICATION_ID/status \
  -H "Content-Type: application/json" \
  -d '{"status": "READ"}'
```

## 🚨 문제 해결

### 일반적인 문제들

1. **포트 충돌**:
   - 8080 포트가 사용 중인 경우 `application.properties`에서 포트 변경
   ```properties
   server.port=8081
   ```

2. **MongoDB 연결 실패**:
   - MongoDB가 실행 중인지 확인
   - 연결 문자열 확인: `mongodb://localhost:27017/notification_system`

3. **Kafka 연결 실패**:
   - Zookeeper와 Kafka가 모두 실행 중인지 확인
   - 토픽이 생성되었는지 확인

4. **메모리 부족**:
   - JVM 힙 크기 조정: `-Xmx512m -Xms256m`

### 로그 확인
```bash
# 애플리케이션 로그에서 오류 확인
tail -f logs/application.log
```

## 📊 성능 테스트

### 부하 테스트 (선택사항)
```bash
# Apache Bench를 사용한 간단한 부하 테스트
ab -n 100 -c 10 http://localhost:8080/api/users
```

## 🎯 다음 단계

시스템이 정상적으로 작동하는 것을 확인한 후:

1. **프로덕션 환경 설정**
2. **보안 강화** (JWT 인증 추가)
3. **모니터링 도구 통합**
4. **알림 전송 채널 확장** (이메일, SMS, 푸시 알림)

## 📞 지원

문제가 발생하면:
1. GitHub Issues에 문제 등록
2. 로그 파일 확인
3. MongoDB와 Kafka 상태 확인

---

**🎉 축하합니다!** 사용자 알림 시스템이 성공적으로 실행되고 있습니다. 